services:
  e2e:
    image: mcr.microsoft.com/playwright:v1.57.0-jammy
    working_dir: /work
    volumes:
      - ./:/work
      # Avoid clobbering host node_modules (macOS) with Linux installs.
      - /work/node_modules
    environment:
      # When running inside Docker, use the host's forwarded ports.
      - PW_BASE_URL=http://host.docker.internal:3090
      - PW_BACKEND_URL=http://host.docker.internal:4000
      - CI=true
      # Keep Playwright artifacts inside the container (not in the repo mount).
      - PW_OUTPUT_DIR=/tmp/pw/test-results
      - PW_HTML_REPORT_DIR=/tmp/pw/playwright-report
      - PW_JSON_REPORT_FILE=/tmp/pw/playwright-results.json
    extra_hosts:
      - "host.docker.internal:host-gateway"
    depends_on:
      - frontend
      - backend
