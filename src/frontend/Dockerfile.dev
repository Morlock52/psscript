FROM node:20-alpine

# Set working directory
WORKDIR /app

# Copy entrypoint script and make it executable
COPY docker-entrypoint.sh /usr/local/bin/
RUN chmod +x /usr/local/bin/docker-entrypoint.sh

# Copy package files
COPY package*.json ./

# Install dependencies during build
RUN npm install --legacy-peer-deps

# Copy source code
COPY . .

# Expose the port the app runs on
EXPOSE 3090

# Set environment variables
ENV NODE_ENV=development
# IMPORTANT:
# Do not set VITE_API_URL to a Docker service hostname (e.g. http://backend:4000/api).
# The browser cannot resolve that hostname, which causes "Network Error" in the UI.
# Leave it unset so the frontend can use runtime detection (src/frontend/src/utils/apiUrl.ts),
# or set it to a browser-reachable URL like https://localhost:4000/api via compose/.env.

# Use entrypoint to install dependencies on startup
ENTRYPOINT ["docker-entrypoint.sh"]

# Run the application in development mode
CMD ["npm", "run", "dev", "--", "--host", "0.0.0.0", "--port", "3090"]
